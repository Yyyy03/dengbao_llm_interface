# -*- coding: utf-8 -*-
doc_type = {
  "国家标准": {
    "28448":{"name":"GBT 28448-2019 信息安全技术 网络安全等级保护测评要求","keywords":[
      "测评要求",
      "第一级安全测评通用要求",
      "第一级云计算安全测评扩展要求",
      "第一级移动互联安全测评扩展要求",
      "第一级物联网安全测评扩展要求",
      "第一级工业控制系统安全测评扩展要求",
      "第一级大数据系统安全评估方法",
      "第二级安全测评通用要求",
      "第二级云计算安全测评扩展要求",
      "第二级移动互联安全测评扩展要求",
      "第二级物联网安全测评扩展要求",
      "第二级工业控制系统安全测评扩展要求",
      "第二级大数据系统安全评估方法",
      "第三级安全测评通用要求",
      "第三级云计算安全测评扩展要求",
      "第三级移动互联安全测评扩展要求",
      "第三级物联网安全测评扩展要求",
      "第三级工业控制系统安全测评扩展要求",
      "第三级大数据系统安全评估方法",
      "第四级安全测评通用要求",
      "第四级云计算安全测评扩展要求",
      "第四级移动互联安全测评扩展要求",
      "第四级物联网安全测评扩展要求",
      "第四级工业控制系统安全测评扩展要求",
      "第四级大数据系统安全评估方法",
      "安全物理环境",
      "安全通信网络",
      "安全区域边界",
      "安全计算环境",
      "安全管理中心",
      "安全管理制度",
      "安全管理机构",
      "安全管理人员",
      "安全建设管理",
      "安全运维管理"
    ]},
    "22240": {
      "name": "GBT 22240—2020 信息安全技术 网络安全等级保护定级指南-报批稿（提交版）-最终提交审批中心版本.pdf",
      "keywords": [
        "定级指南",
        "安全保护等级",
        "定级要素",
        "定级对象",
        "定级方法",
        "定级流程",
        "确定安全保护等级",
        "等级变更"
      ]
    },
    "28449": {
      "name": "GB∕T 28449-2018 信息安全技术 网络安全等级保护测评过程指南",
      "keywords": [
        "测评过程指南",
        "规范等级测评过程",
        "等级测评风险",
        "测评准备活动工作流程",
        "测评准备活动主要任务",
        "方案编制活动工作流程",
        "方案编制活动主要任务",
        "现场测评活动工作流程",
        "现场测评活动主要任务",
        "报告编制活动工作流程",
        "报告编制活动主要任务",
        "等级测评工作要求",
        "云计算等级测评实施补充",
        "物联网等级测评实施补充",
        "移动互联等级测评实施补充",
        "工业控制系统等级测评实施补充",
        "测评对象确定准则",
        "等级测评现场测评方式"
      ]
    },
    "25070": {
      "name": "GB∕T 25070-2019 信息安全技术 网络安全等级保护安全设计技术要求",
      "keywords": [
        "安全设计技术要求",
        "设计安全技术方案",
        "实施安全技术方案",
        "第一级系统安全设计目标",
        "第一级系统安全设计策略",
        "第一级系统安全设计技术要求",
        "第二级系统安全设计目标",
        "第二级系统安全设计策略",
        "第二级系统安全设计技术要求",
        "第三级系统安全设计目标",
        "第三级系统安全设计策略",
        "第三级系统安全设计技术要求",
        "第四级系统安全设计目标",
        "第四级系统安全设计策略",
        "第四级系统安全设计技术要求",
        "定级系统互联安全设计目标",
        "定级系统互联安全设计策略",
        "定级系统互联安全设计技术要求"
      ]
    }
  },
  "行业标准": {
    "JRT0060": {
      "name": "JR∕T 0060-2021 金融行业网络安全等级保护基本要求.pdf",
      "keywords": [
        "证券期货业基本要求",
        "证券期货业第一级安全通用要求",
        "证券期货业第一级云计算安全扩展要求",
        "证券期货业第一级移动互联安全扩展要求",
        "证券期货业第一级物联网安全扩展要求",
        "证券期货业第一级工业控制系统安全扩展要求",
        "证券期货业第一级大数据系统安全控制措施",
        "证券期货业第二级安全通用要求",
        "证券期货业第二级云计算安全扩展要求",
        "证券期货业第二级移动互联安全扩展要求",
        "证券期货业第二级物联网安全扩展要求",
        "证券期货业第二级工业控制系统安全扩展要求",
        "证券期货业第二级大数据系统安全控制措施",
        "证券期货业第三级安全通用要求",
        "证券期货业第三级云计算安全扩展要求",
        "证券期货业第三级移动互联安全扩展要求",
        "证券期货业第三级物联网安全扩展要求",
        "证券期货业第三级工业控制系统安全扩展要求",
        "证券期货业第三级大数据系统安全控制措施",
        "证券期货业第四级安全通用要求",
        "证券期货业第四级云计算安全扩展要求",
        "证券期货业第四级移动互联安全扩展要求",
        "证券期货业第四级物联网安全扩展要求",
        "证券期货业第四级工业控制系统安全扩展要求",
        "证券期货业第四级大数据系统安全控制措施",
        "安全物理环境",
        "安全通信网络",
        "安全区域边界",
        "安全计算环境",
        "安全管理中心",
        "安全管理制度",
        "安全管理机构",
        "安全管理人员",
        "安全建设管理",
        "安全运维管理"
      ]
    },
    "JRT0071": {
      "name": "JR∕T 0071.2-2020 金融行业网络安全等级保护实施指引 第2部分：基本要求.pdf",
      "keywords": [
        "等级评估方法",
        "等级评估风险",
        "等级评估准备活动工作流程",
        "等级评估准备活动主要任务",
        "等级评估方案编制活动工作流程",
        "等级评估方案编制活动主要任务",
        "等级评估现场测评活动工作流程",
        "等级评估现场测评活动主要任务",
        "等级评估报告编制活动工作流程",
        "等级评估报告编制活动主要任务",
        "等级评估工作要求"
      ]
    }
  },
  "团体标准": {
    "网络安全等级保护测评高风险判定实施指引": {
      "name": "网络安全等级保护测评高风险判定实施指引（试行）",
      "keywords": [
        "判定原则",
        "标准要求",
        "适用范围",
        "问题描述",
        "可能的缓解措施",
        "风险评价",
        "安全通用要求高风险判例",
        "云计算安全扩展要求高风险判例",
        "移动互联安全扩展要求高风险判例",
        "物联网安全扩展要求高风险判例",
        "工业控制系统安全扩展要求高风险判例",
        "安全物理环境",
        "安全通信网络",
        "安全区域边界",
        "安全计算环境",
        "安全管理中心",
        "安全管理制度",
        "安全管理机构",
        "安全管理人员",
        "安全建设管理",
        "安全运维管理"
      ]
    }
  },
  "法律法规": {
    "网络安全法": {
      "name": "网络安全法",
      "keywords": []
    }
  },
  "其他": {
    "关于对网络安全等级保护有关工作事项进一步说明的函": {
      "name": "关于对网络安全等级保护有关工作事项进一步说明的函（公网安〔2025〕1846号）",
      "keywords": [
        "生效日期2025年4月27日",
        "系统备案动态更新",
        "选择备案地",
        "备案证明",
        "第五级网络系统的定义",
        "第五级网络系统如何开展等级测评",
        "数据摸底调查",
        "高风险问题的主要判定依据",
        "2025版网络安全等级保护测评报告",
        "重大风险隐患概念",
        "保护工作方案"
      ]
    },
    "测评机构在沪工作指引规范手册": {
      "name": "测评机构在沪工作指引规范手册（2025年2月版）",
      "keywords": [
        "上海",
        "测评机构在沪开展测评活动",
        "上海市等保办",
        "测评机构管理",
        "机构申请与报备",
        "首个测评项目",
        "测评月报管理",
        "机构处置管理",
        "测评项目管理",
        "项目申请",
        "项目实施",
        "项目审核",
        "项目关闭",
        "承诺书模板",
        "会面介绍信模板",
        "等级保护综合管理平台注册信息",
        "等级保护综合管理平台用户手册",
        "测评机构月报模板",
        "漏洞扫描或渗透测试放弃说明模板",
        "网络安全等级保护安全扩展要求测评实施参考",
        "现场检查表",
        "关于出具测评结论的报告（模板）",
        "网络基础摸排上报表-重要网络系统类",
        "网络基础摸排上报表-关键供应链类",
        "合规检查表"
      ]
    }
  }
}
def gen_multi_doc_prompt(query,context):

  multi_doc_conclue_prompt = f"""
  你是一个网络安全等级保护领域的智能问答助手，你需要参考用户的问题，从知识库检索结果中提取相关性最高的信息，并生成准确的总结
  原始问题：
  {query}
  
  知识库检索结果为
  {context}
  """
  return multi_doc_conclue_prompt





if __name__ == "__main__":
    query = "某三级系统的业务应用系统是使用用户名+口令的方式对登录用户进行身份鉴别的，根据等保相关要求，这是否存在什么问题？如果存在问题的话，一般将此问题的级别判定为高风险、中风险还是低风险？是否存在缓解措施？"
    context = """
    {
    "国家标准": "根据您提供的原始问题及知识库检索结果，结合《GB/T 28448-2019 信息安全技术 网络安全等级保护测评要求》中关于**第三级系统**的相关要求，现对问题进行专业分析与总结如下：\n\n---\n\n### ✅ **一、是否存在安全问题？**\n\n**存在安全隐患。**\n\n虽然第三级系统允许使用“用户名+口令”方式进行身份鉴别，但**仅依赖单一因素（用户名+口令）的身份鉴别机制不符合等保三级的更高安全要求**。\n\n依据《GB/T 28448-2019》中对**身份鉴别**控制点的通用要求（虽未在检索结果中直接列出，但可依据标准整体框架推导）：\n\n- 第三级系统要求：**应采用两种或两种以上身份鉴别技术**，实现**多因素认证（MFA）**，以增强身份鉴别的安全性。\n- 单一口令方式易受暴力破解、字典攻击、密码泄露、重放攻击等威胁，无法满足第三级系统对**身份可信性**和**防冒用**的严格要求。\n\n> 📌 **结论**：仅使用“用户名+口令”作为身份鉴别方式，**不符合等保三级关于身份鉴别机制的增强要求**，属于**安全缺陷**。\n\n---\n\n### ✅ **二、风险级别判定：高风险 / 中风险 / 低风险？**\n\n**判定为：高风险**\n\n#### 判定依据如下：\n\n1. **控制点重要性**：  \n   “身份鉴别”是网络安全等级保护的核心控制点之一（如“身份鉴别”、“访问控制”、“安全审计”等），其失效可能导致系统被未授权访问、数据泄露、权限滥用等严重后果。\n\n2. **第三级系统的安全要求**：  \n   根据《GB/T 28448-2019》第8章“第三级测评要求”，第三级系统需具备较强的安全防护能力。若仅使用弱身份鉴别机制，将导致系统面临**高等级安全风险**。\n\n3. **风险分析标准参考**：  \n   依据知识库中《12.2 等级测评结论》规定：\n   > “不符合：定级对象中存在安全问题，……**而且存在的安全问题会导致定级对象面临高等级安全风险**，或者中低风险所占比例超过阈值。”\n\n   本问题中，身份鉴别机制薄弱，可能引发**越权访问、数据篡改、系统被控制**等后果，直接影响业务信息安全和系统服务安全，**属于高等级安全风险**。\n\n> 📌 **结论**：该问题应判定为 **高风险**。\n\n---\n\n### ✅ **三、是否存在缓解措施？**\n\n**存在缓解措施，但需明确：仅缓解不等于合规。**\n\n#### ✅ 可采取的缓解措施包括：\n\n| 缓解措施 | 说明 |\n|--------|------|\n| **启用强密码策略** | 要求口令长度≥8位，包含大小写字母、数字、特殊字符；定期更换（如每90天）；禁止重复使用历史密码。 |\n| **账户锁定机制** | 连续5次登录失败后锁定账户15分钟，防止暴力破解。 |\n| **登录行为审计** | 记录所有登录尝试（成功/失败），并留存至少6个月，便于追溯。 |\n| **增加临时性二次验证**（如短信验证码、动态令牌） | 作为临时缓解手段，实现“双因素认证”（2FA）的初步形式。 |\n| **部署WAF/IPS** | 防止自动化脚本攻击、暴力破解等行为。 |\n\n#### ⚠️ 重要提醒：\n- 上述措施属于**风险缓解**，但**不能替代多因素认证**。\n- 若系统长期仅依赖“用户名+口令”，即便有上述防护，仍**不符合等保三级的强制性要求**。\n- **最终合规路径是：升级为多因素身份鉴别机制（如：口令 + 硬件令牌 / 手机令牌 / 生物特征 / 数字证书等）**。\n\n---\n\n### ✅ **总结结论（简洁版）**\n\n| 项目 | 结论 |\n|------|------|\n| 是否存在问题 | ✅ 存在，身份鉴别方式不符合等保三级要求 |\n| 风险级别 | ⚠️ **高风险**（可能导致系统被非法访问、数据泄露） |\n| 是否可缓解 | ✅ 可通过强密码策略、账户锁定、审计、2FA等措施缓解风险 |\n| 是否合规 | ❌ **仅缓解不合规**，必须升级为**多因素身份鉴别机制**才能满足等保三级要求 |\n\n---\n\n### 📌 建议行动项：\n\n1. **立即评估当前系统身份鉴别机制**；\n2. **制定升级计划**，引入双因素认证（2FA）或更高强度认证方式；\n3. **在测评前完成改造**，避免因“身份鉴别”项不合格导致整体测评“不符合”；\n4. **参考《GB/T 25070-2019》附录B中“策略初始化流程”和“计算节点启动流程”**，建立基于可信身份的访问控制体系。\n\n---\n\n如需进一步提供“多因素认证实施方案”或“等保三级身份鉴别项测评检查表”，可继续提问。",
    "行业标准": "根据您提供的原始问题及知识库检索结果，现对问题进行分析与总结如下：\n\n---\n\n### **一、是否存在安全问题？**\n\n**存在严重问题。**\n\n根据《JR/T 0060-2021 金融行业网络安全等级保护基本要求》和《JR/T 0071.2-2020 金融行业网络安全等级保护实施指引 第2部分：基本要求》中关于**第三级系统**的“安全通用要求”中“**8.1.4.1 身份鉴别**”条款的规定：\n\n> **应采用口令、密码技术、生物技术等两种或两种以上组合的鉴别技术对用户进行身份鉴别，且其中一种鉴别技术至少应使用密码技术来实现。**\n\n而当前系统仅使用“用户名+口令”这一种鉴别方式（即单一因素认证），**不符合第三级系统对多因素身份鉴别的强制性要求**。\n\n此外，即使口令满足长度、复杂度等要求（如8位以上、字母数字符号混合、定期更换），**单一口令机制仍无法满足“双因素及以上”的安全要求**，存在被暴力破解、口令泄露、重放攻击等风险。\n\n---\n\n### **二、问题风险等级判定**\n\n**判定为：高风险**\n\n理由如下：\n- 该要求属于**第三级安全通用要求中的强制性条款**（标注为F3，即“强制”类要求）。\n- 身份鉴别是系统安全的第一道防线，若仅依赖单一口令，极易导致未授权访问、账户劫持、数据泄露等严重后果。\n- 在金融行业背景下，第三级系统通常承载重要业务和敏感数据，对身份鉴别的安全性要求极高。\n- 多因素认证缺失属于**基础性安全缺陷**，直接威胁系统整体安全防护能力。\n\n因此，依据等保2.0及金融行业标准，该问题应被定性为**高风险**。\n\n---\n\n### **三、是否存在缓解措施？**\n\n**无法从根本上缓解，必须整改。**\n\n虽然在某些特定场景下可采取辅助措施（如加强口令复杂度、限制登录尝试次数、启用会话超时等），但这些措施**不能替代多因素身份鉴别**，属于“**降级或缓解措施**”，**不能作为合规性替代方案**。\n\n#### ✅ 合规性整改建议（必须实施）：\n1. **引入双因素或多因素认证机制**，例如：\n   - 口令 + 短信验证码（动态口令）\n   - 口令 + 数字证书（PKI）\n   - 口令 + 令牌（如Google Authenticator、硬件Key）\n   - 口令 + 生物特征（指纹、人脸识别，需结合密码技术）\n\n2. **确保至少一种鉴别技术使用密码技术实现**（如动态口令生成、数字证书验证等）。\n\n3. **对远程管理用户强制要求双因素认证**，尤其针对管理员账户。\n\n4. **对现有用户进行认证方式升级**，逐步淘汰单一口令登录。\n\n---\n\n### **四、总结**\n\n| 项目 | 内容 |\n|------|------|\n| 是否存在问题 | ✅ 存在，严重违反等保三级身份鉴别要求 |\n| 问题类型 | 单一身份鉴别方式（仅用户名+口令） |\n| 风险等级 | ⚠️ **高风险**（强制性条款未满足） |\n| 是否可缓解 | ❌ **不可完全缓解**，必须升级为双因素或以上认证 |\n| 合规建议 | 实施口令 + 动态口令/数字证书/生物识别等组合认证机制 |\n\n---\n\n### **依据标准条文引用：**\n- 《JR/T 0060-2021》第8.1.4.1 d条：  \n  > “应采用口令、密码技术、生物技术等两种或两种以上组合的鉴别技术……”\n- 《JR/T 0071.2-2020》第8.1.4.1 d条：  \n  > “管理用户以网络方式登录系统，应采用两种或两种以上组合的鉴别技术进行身份鉴别。”\n\n---\n\n### ✅ 结论：\n> **该三级系统仅使用“用户名+口令”方式进行身份鉴别，不符合等保三级对多因素身份鉴别的强制要求，属于高风险问题，必须立即整改，升级为双因素及以上认证机制，不得以其他措施替代。**",
    "团体标准": "根据您提供的问题及知识库检索结果，现对“某三级系统使用用户名+口令方式登录，是否存在安全问题”进行专业分析与总结如下：\n\n---\n\n### **一、是否存在安全问题？**\n\n**存在安全问题。**\n\n依据《网络安全等级保护测评高风险判定实施指引（试行）》中关于**安全计算环境**部分的“**6.4.1.3 未采用两种或两种以上组合身份鉴别技术**”这一高风险判例，明确指出：\n\n> 对于**三级系统**，必须采用**两种或两种以上**的身份鉴别技术（如：用户名+口令 + 动态令牌、数字证书、生物特征等），仅使用“用户名+口令”方式属于**单一因素鉴别**，不符合GB/T 22239—2019《信息安全技术 网络安全等级保护基本要求》中对第三级系统在身份鉴别方面的强制性要求。\n\n因此，该系统仅使用用户名+口令进行身份鉴别，**违反了等保三级对身份鉴别机制的组合性要求**，属于**不符合关键安全功能**的情形。\n\n---\n\n### **二、风险等级判定：高风险**\n\n根据《网络安全等级保护测评高风险判定实施指引（试行）》中“**5.2 判定原则**”：\n\n> 符合以下任一条件的安全问题应判为**高风险**：\n> - 不符合或未实现GB/T 22239—2019中各等级关键安全要求及基本安全功能，且**没有可缓解措施**；\n> - 存在高度可被利用，且对业务信息安全和系统服务安全造成严重后果的安全问题。\n\n本案例中：\n- 三级系统未实现“两种以上组合身份鉴别技术”这一**关键安全要求**；\n- 且知识库中未提供有效的、可完全抵消该缺陷的缓解措施（如：动态令牌、双因子认证、行为分析等）；\n- 单一口令机制极易受到暴力破解、撞库、钓鱼、会话劫持等攻击，一旦被攻破，将直接导致非法用户获取系统权限，造成**严重的业务信息泄露或系统服务中断**。\n\n因此，**该问题应判定为高风险**。\n\n---\n\n### **三、是否存在缓解措施？**\n\n虽然当前系统仅使用用户名+口令，但**存在部分可缓解措施**，可**酌情降低风险等级**，但**不能消除高风险判定**，需结合实际情况评估：\n\n参考知识库中“**9.3.2.1 网关节点设备连接无身份鉴别措施**”的判例描述：\n\n> “但网关节点设备具有设备连接管控措施、物理访问控制等措施，可根据实际措施效果酌情降低风险等级。”\n\n同理，若该业务系统具备以下**辅助性控制措施**，可在一定程度上缓解风险：\n\n- **登录失败次数限制**（如：连续5次失败锁定账户）；\n- **登录行为审计与告警机制**（如：异常IP登录触发告警）；\n- **强口令策略**（长度、复杂度、定期更换）；\n- **多因素认证（MFA）的试点或部分部署**（如短信验证码、动态令牌）；\n- **登录IP/终端绑定机制**；\n- **会话超时自动退出机制**。\n\n> ⚠️ 注意：上述措施属于**辅助性控制**，**不能替代“两种以上组合身份鉴别”**。若未部署真正意义上的双因子或多因子认证，仍无法满足等保三级要求。\n\n---\n\n### **四、结论总结**\n\n| 项目 | 结论 |\n|------|------|\n| 是否存在问题 | ✅ 存在，违反等保三级身份鉴别要求 |\n| 问题性质 | 未采用两种或以上组合身份鉴别技术 |\n| 风险等级 | ❗**高风险**（因违反关键安全要求且无有效缓解措施） |\n| 缓解措施 | 可通过强口令策略、登录限制、行为审计等措施**部分缓解**，但**不能改变高风险判定** |\n| 建议整改 | **立即升级为双因子或以上身份鉴别机制**，如：用户名+口令 + 动态令牌、短信验证码、数字证书、生物识别等，以满足等保三级合规要求 |\n\n---\n\n### ✅ 建议整改方向（依据等保2.0标准）：\n- 在系统登录环节引入**双因素认证（2FA）**；\n- 部署**统一身份认证平台（IAM）**，支持多因素鉴别的集中管理；\n- 对现有用户进行分阶段改造，优先保障管理员、核心业务用户启用双因子认证；\n- 定期开展身份鉴别机制的渗透测试与合规性评估。\n\n---\n\n如需进一步制定整改方案或生成等保测评报告中的问题描述，可继续提供系统部署细节。",
    "法律法规": "根据您提出的问题，结合《网络安全法》及相关网络安全等级保护制度要求，现对三级系统使用“用户名+口令”方式进行身份鉴别存在的问题进行分析，并给出风险等级判定及缓解措施建议：\n\n---\n\n### 一、是否存在合规问题？\n\n**存在合规问题。**\n\n虽然《网络安全法》未直接规定身份鉴别必须采用多因素认证，但依据《**信息安全技术 网络安全等级保护基本要求**》（GB/T 22239-2019，即等保2.0标准）中对**三级系统**的明确要求：\n\n- 在 **安全计算环境**（第三级）中，对身份鉴别有如下要求：\n  > **A.3.2.2 身份鉴别（3级）**  \n  > 应采用两种或两种以上组合的鉴别技术对用户进行身份鉴别，且其中一种应为动态口令、生物特征或数字证书等。\n\n而当前系统仅使用“用户名+静态口令”方式，属于**单一因素鉴别**，不符合等保三级对身份鉴别的强制性要求。\n\n此外，《网络安全法》第二十一条也强调网络运营者应采取“防范网络攻击、网络侵入等危害网络安全行为的技术措施”，而弱口令或单一认证机制易导致账户被暴力破解、撞库攻击等，属于典型的可被利用的安全风险点。\n\n---\n\n### 二、风险级别判定：**高风险**\n\n理由如下：\n\n- 三级系统属于重要信息系统，承载关键业务，一旦发生身份冒用、未授权访问，可能导致数据泄露、业务中断或重大经济损失。\n- 单一口令认证机制存在明显安全缺陷，易受以下攻击：\n  - 暴力破解\n  - 社会工程学钓鱼\n  - 口令泄露后横向渗透\n- 该问题直接违反等保2.0标准中关于“多因素身份鉴别”的强制性条款。\n- 在等保测评实践中，此类问题通常被判定为**高风险项**，尤其在涉及核心业务系统时。\n\n---\n\n### 三、缓解措施建议（整改建议）\n\n为满足等保三级要求并降低安全风险，建议采取以下措施：\n\n1. **实施多因素身份鉴别（MFA）**：\n   - 推荐组合方式：**用户名 + 静态口令 + 动态口令（如短信验证码、TOTP令牌）** 或 **数字证书 + 口令**。\n   - 可选用成熟的双因素认证方案，如：Google Authenticator、华为eID、U盾、短信验证等。\n\n2. **强化口令策略**：\n   - 设置复杂度要求（长度≥8位，含大小写字母、数字、特殊字符）；\n   - 定期更换口令（建议不超过90天）；\n   - 限制登录尝试次数（如5次失败锁定账户15分钟）；\n   - 禁止使用弱口令（如“123456”、“admin”等）。\n\n3. **启用登录行为审计与监控**：\n   - 记录所有登录尝试（成功/失败），留存日志不少于6个月；\n   - 异常登录行为（如异地登录、高频失败）应触发告警。\n\n4. **推动统一身份认证平台建设**：\n   - 长期可考虑建设基于RBAC（基于角色的访问控制）的统一认证中心，集成MFA、单点登录（SSO）、会话管理等功能。\n\n---\n\n### 四、总结\n\n| 项目 | 内容 |\n|------|------|\n| 是否存在问题 | ✅ 存在，不符合等保三级身份鉴别要求 |\n| 风险等级 | ⚠️ **高风险** |\n| 主要依据 | 《网络安全等级保护基本要求》GB/T 22239-2019 第三级身份鉴别条款 |\n| 推荐整改措施 | 实施多因素身份鉴别（MFA），加强口令策略与日志审计 |\n\n---\n\n> ✅ **建议立即启动整改工作，确保在下一次等保测评前完成升级，避免因不符合项导致测评不通过或监管处罚。**\n\n如需，可进一步提供MFA实施方案模板或等保测评整改清单。",
    "其他": "根据您提出的问题，结合《网络安全等级保护》相关要求及知识库内容（尽管检索结果未直接涉及身份鉴别具体条款，但可依据等保2.0标准和常见风险判定原则进行分析），现对问题进行专业解答如下：\n\n---\n\n### **一、是否存在安全问题？**\n\n**存在安全问题。**\n\n依据《信息安全技术 网络安全等级保护基本要求》（GB/T 22239-2019）中对**第三级信息系统**的相关要求，针对身份鉴别部分，有如下明确规定：\n\n- **第5.2.2.1条**：应对登录用户进行身份标识和鉴别，身份标识应具有唯一性，身份鉴别信息应具有复杂度要求，并定期更换。\n- **第5.2.2.2条**：应采用两种或两种以上组合的鉴别技术对用户进行身份鉴别，且其中一种应为动态口令、生物特征等。\n- **第5.2.2.3条**：应具有登录失败处理机制，如限制非法登录次数、锁定账户等。\n\n而当前系统仅采用“用户名+口令”方式，属于**单因素身份鉴别**，未满足“两种或以上组合鉴别技术”的要求，**不符合第三级系统对身份鉴别的强制性要求**。\n\n---\n\n### **二、问题风险等级判定：高风险**\n\n该问题应判定为 **高风险**。\n\n**判定依据如下：**\n\n1. **违反等保三级核心要求**：第三级系统必须采用多因素认证（如用户名+口令+动态令牌/短信验证码/指纹等），仅使用用户名+口令属于典型不符合项。\n2. **参考《网络安全等级保护测评高风险判定实施指引》**（知识库中提及）：虽未直接列出该条，但根据其精神，**未实现多因素身份鉴别且影响系统核心安全控制**的情形，属于高风险范畴。\n3. **潜在攻击面大**：单一口令易受暴力破解、字典攻击、钓鱼、泄露等威胁，一旦被攻破，将导致系统被非法访问，造成严重数据泄露或业务中断。\n\n因此，该问题属于**高风险**。\n\n---\n\n### **三、缓解措施（整改建议）**\n\n为满足等保三级要求并降低安全风险，建议采取以下缓解措施：\n\n| 措施 | 说明 |\n|------|------|\n| **启用双因素认证（2FA）** | 在用户名+口令基础上，增加动态口令（如短信验证码、硬件令牌、手机APP生成的TOTP）或生物特征（如指纹、人脸）等第二种鉴别方式。 |\n| **部署身份认证网关或IAM系统** | 引入统一身份认证平台，支持多因素认证、会话管理、行为审计等功能，提升整体安全能力。 |\n| **加强口令策略** | 即使作为辅助手段，也应设置强口令策略：长度≥8位、包含大小写字母、数字、特殊字符，定期更换（如每90天），禁止重复使用。 |\n| **启用登录失败锁定机制** | 连续5次登录失败后锁定账户15分钟，防止暴力破解。 |\n| **记录并审计登录行为** | 对所有登录操作进行日志记录，包括时间、IP、用户名、结果等，便于事后追溯。 |\n\n---\n\n### **四、总结**\n\n- ✅ **问题存在**：仅使用“用户名+口令”方式，不符合第三级系统对多因素身份鉴别的强制要求。\n- ⚠️ **风险等级**：**高风险**（违反等保三级核心控制项，可能导致系统被非法访问）。\n- ✅ **整改建议**：立即实施双因素认证（2FA），并配套加强口令策略与登录审计。\n\n> **建议**：在年度等保测评中，该问题将作为**重大风险隐患**被重点指出，需在保护工作方案中明确整改计划（依据知识库中“问题二十三”要求），并纳入后续整改闭环管理。\n\n--- \n\n如需进一步提供整改方案模板或双因素认证部署建议，可继续咨询。"
}
    """


    prompt = gen_multi_doc_prompt(query,context)
    from raptor.multi_doc_search import openai_api_seu
    import config as cf
    res = openai_api_seu(prompt,cf.llm_models["qwen3-30b-2507"],"qwen3-30b-2507")
    print(res)